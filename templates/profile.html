<!-- templates/profile.html -->
{% extends "base-for-dashboard.html" %}

{% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<div class="profile-container">
    <div class="profile-header">
        <h1 class="profile-title">üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
        <div class="profile-status {% if user.is_teacher %}teacher{% else %}student{% endif %}">
            {{ '–£—á–∏—Ç–µ–ª—å' if user.is_teacher else '–£—á–µ–Ω–∏–∫' }}
        </div>
    </div>

    <div class="profile-card">
        <div class="avatar-section">
            <div class="avatar-circle">
                {% if user.avatar == None %}
                <span class="avatar-initials">{{ user.last_name[0] }}{{ user.first_name[0] }}</span>
                {% else %}
                <img src="{{ url_for('static', filename='avatars/' + user.avatar) }}" alt="–ê–≤–∞—Ç–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
                    style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                {% endif %}
            </div>
            <form action="/logout">
                <button class="edit-btn"> –í—ã–π—Ç–∏ </button>
            </form>
        </div>

        <div class="profile-info">
            <div class="info-item">
                <span class="info-label">üìõ –§–ò–û:</span>
                <p class="info-value">{{ user.last_name }} {{ user.first_name }} {{ user.middle_name }}</p>
            </div>

            <div class="info-item">
                <span class="info-label">‚úâÔ∏è –≠–ª. –ø–æ—á—Ç–∞:</span>
                <p class="info-value">{{ user.email }}</p>
            </div>

            <div class="info-item">
                <span class="info-label">üéì –°—Ç–∞—Ç—É—Å:</span>
                <p class="info-value">{{ '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å' if user.is_teacher == 1 else '–û–±—É—á–∞—é—â–∏–π—Å—è' }}</p>
            </div>
            <div class="info-item">
                <span class="info-label">üåå ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</span>
                <p class="info-value">{{user_id}}</p>
            </div>
        </div>
    </div>

    {% if user.is_teacher == 0 %}
    <div class="additional-info">
        <div class="stats-card">
            <h3>üìä –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h3>
            <div>
                <canvas id="tasksChart"></canvas>
            </div>
            <script>
                // –î–∞–Ω–Ω—ã–µ –∏–∑ Flask-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                const labels = {{ labels | safe }};
                const correctData = {{ correct | safe }};
                const incorrectData = {{ incorrect | safe }};

                // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–∏–∞–≥—Ä–∞–º–º—ã
                const ctx = document.getElementById('tasksChart').getContext('2d');
                const tasksChart = new Chart(ctx, {
                    type: 'bar', // —Å—Ç–æ–ª–±—á–∞—Ç–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞
                    data: {
                        labels: labels, // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (–º–µ—Å—è—Ü—ã)
                        datasets: [
                            {
                                label: '–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏',
                                data: correctData, // –î–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á
                                backgroundColor: 'rgba(75, 192, 192, 0.5)', // –¶–≤–µ—Ç –¥–ª—è —Å—Ç–æ–ª–±—Ü–æ–≤
                                borderColor: 'rgba(75, 192, 192, 1)', // –¶–≤–µ—Ç —Ä–∞–º–∫–∏
                                borderWidth: 1
                            },
                            {
                                label: '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏',
                                data: incorrectData, // –î–∞–Ω–Ω—ã–µ –¥–ª—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á
                                backgroundColor: 'rgba(255, 99, 132, 0.5)', // –¶–≤–µ—Ç –¥–ª—è —Å—Ç–æ–ª–±—Ü–æ–≤
                                borderColor: 'rgba(255, 99, 132, 1)', // –¶–≤–µ—Ç —Ä–∞–º–∫–∏
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true, // –î–∏–∞–≥—Ä–∞–º–º–∞ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ —Ä–∞–∑–º–µ—Ä—É –æ–∫–Ω–∞
                        plugins: {
                            legend: {
                                position: 'top', // –õ–µ–≥–µ–Ω–¥–∞ —Å–≤–µ—Ä—Ö—É
                            },
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        return `${context.dataset.label}: ${context.raw}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: '‚Ññ –ó–∞–¥–∞—á–∏', // –ü–æ–¥–ø–∏—Å—å –¥–ª—è –æ—Å–∏ X
                                }
                            },
                            y: {
                                beginAtZero: true, // –ù–∞—á–∞–ª–æ –æ—Å–∏ Y —Å 0
                                title: {
                                    display: true,
                                    text: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á', // –ü–æ–¥–ø–∏—Å—å –¥–ª—è –æ—Å–∏ Y
                                }
                            }
                        }
                    }
                });
            </script>
        </div>
    </div>
    {% endif %}

    <div class="additional-info">
        <div class="stats-card">
            <h3>üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
            <div class="achievements-container">
                {% for award in awards %}
                <div class="achievement-card">
                    <h4>{{ award[0] | safe }}</h4>
                    <p class="level">–£—Ä–æ–≤–µ–Ω—å: {{ award[2] }}</p>
                    <div class="progress-bar">
                        <div class="progress" style="width: {{ (award[1] / award[3]) * 100 }}%;"></div>
                        <p class="progress-text">{{ award[1] }}/{{ award[3] }}</p>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

</div>
{% endblock %}